x.zinc.sq <- x.zinc*x.zinc
y.zinc.sq <- y.zinc*y.zinc
x.y.zinc <- x.zinc*y.zinc
mod.lzinc.sq <- lm(l.zinc~x.zinc+y.zinc+x.zinc.sq+y.zinc.sq+x.y.zinc)
coeff.lzinc.sq <- summary(mod.lzinc.sq)$coeff[1:6]
trend.lzinc <- mod.lzinc.sq$fitted.values
res.lzinc.sq <- l.zinc-trend.lzinc
surf.est.surface.lzinc.sq <- interp(x.zinc,y.zinc,trend.lzinc)
library(akima)
library(MASS)
library(fields)
library(akima)
library(RColorBrewer)
library(classInt)
library(gstat)
library(sp)
data(meuse)
x.zinc <- meuse$x
y.zinc <- meuse$y
zinc <- meuse$zinc
# We work with the log zinc concentration, because the distribution of zinc is skewed and to reduce the variability
l.zinc <- log(zinc)
# Here we estimate the trend using a quadratic trend surface model
x.zinc.sq <- x.zinc*x.zinc
y.zinc.sq <- y.zinc*y.zinc
x.y.zinc <- x.zinc*y.zinc
mod.lzinc.sq <- lm(l.zinc~x.zinc+y.zinc+x.zinc.sq+y.zinc.sq+x.y.zinc)
coeff.lzinc.sq <- summary(mod.lzinc.sq)$coeff[1:6]
trend.lzinc <- mod.lzinc.sq$fitted.values
res.lzinc.sq <- l.zinc-trend.lzinc
surf.est.surface.lzinc.sq <- interp(x.zinc,y.zinc,trend.lzinc)
plotvar <- surf.est.surface.lzinc.sq$z[!is.na(surf.est.surface.lzinc.sq$z)]
nclr <- 9
plotclr <- brewer.pal(nclr,"YlOrRd")
class <- classIntervals(plotvar,nclr,style="fixed",fixedBreaks=seq(min(plotvar),max(plotvar),length=nclr+1))
names(class)
class$brks
colcode <- findColours(class,plotclr)
image.plot(surf.est.surface.lzinc.sq$x,surf.est.surface.lzinc.sq$y,
surf.est.surface.lzinc.sq$z,col=plotclr,breaks=seq(4,8,length=10),
zlim=c(4,8),xlab="X",ylab="Y",main="Estimated spatial trend")
emp.variog.lzinc <- variogram(res.lzinc.sq~1,locations=~x.zinc+y.zinc,lzinc.data)
lzinc.data <- data.frame(cbind(x.zinc,y.zinc,res.lzinc.sq))
emp.variog.lzinc <- variogram(res.lzinc.sq~1,locations=~x.zinc+y.zinc,lzinc.data)
emp.variog.lzinc
# This is to plot the empirical variogram
plot(emp.variog.lzinc,col="black",type="p",pch=20)
---
title: "Spatial HW2"
author: "Daniel Walter"
date: "Wednesday, February 18, 2015"
output: html_document
---
```{r}
library(fields)
setwd("E:/Dropbox/Homework/BIOSTAT696/data")
#setwd("C:/Users/Daniel/Dropbox/Homework/BIOSTAT696/data")
ozone<-read.table("Observed_ozone_concentration_subregion.txt",header=TRUE)
bp<-read.table("Blood_pressure_data.txt",header=TRUE)
ozone[["center_id"]]<-seq(1,nrow(ozone),by=1)
bp$case_id<-seq(1,nrow(bp),by=1)
```
##### (1a) Distances.
To start, we need to find the closest station for each individual. To do this, we will find the distance from each point to all of the stations, then grab the lowest one.
```{r}
xy_bp<-cbind(bp$X.coord,bp$Y.coord)
names(xy_bp)<-c("X","Y")
xy_oz<-cbind(ozone$X.coord,ozone$Y.coord)
names(xy_oz)<-c("X","Y")
distances<-rdist(xy_bp,xy_oz)
get_min<-function(distances){
center_id=rep(0,nrow(distances))
center_dist=rep(0,nrow(distances))
for (i in 1:nrow(distances)){
cid<-which.min(distances[i,])
center_id[i]<-cid
center_dist[i]<-distances[i,cid]
}
output<-data.frame(center_id,center_dist)
output
}
columns<-get_min(distances)
bp[["center_id"]]<-columns$center_id
bp[["center_dist"]]<-columns$center_dist
subset_5<-subset(bp,center_dist<5)
summary(bp)
summary(subset_5)
nrow(subset_5)
```
The subset of observations within 5 miles of the center is 142, so we had relatively few observations left after discarding the distant observations.
The two seem fairly similar in distribution. So we will merge the data based on the center_id found in the previous section.
```{r}
big_data<-merge(bp, ozone, by.x = "center_id", by.y = "center_id", all.x = TRUE)
big_data <- big_data[order(big_data$case_id),]
big_subset<-subset(big_data,center_dist<5)
```
##### (1b) Linear regression
```{r}
first_reg<-lm(big_subset$Blood_pressure ~ big_subset$Ozone)
summary(first_reg)
```
For my analysis, $\hat{\beta_0}$ was 80.825 and $\hat{\beta_1}$ was 0.034, so for the subset of individuals who were within 5 miles of an ozone measuring station, the effect was underestimated (more of the variance was attributed to the intercept and less to the $\hat{\beta_1}$ than in the true population values.)
View(big_data)
View(big_data)
emp_mod<-lm(big_data$Blood_pressure ~ big_data$CMAQ.x)
View(ozone)
emp_mod<-lm(ozone$Ozone ~ ozone$CMAQ)
emp_trend<-emp_mod$fitted.values
emp_trend
emp_res<-ozone$Ozone-emp_trend
emp_res
View(ozone)
?variogram
emp_var_oz<- variogram(emp_res~1,locations=~ozone$X.coord+ozone$Y.coord,ozone)
emp_var_oz<- variogram(emp_res~1,locations=~ozone$X.coord+ozone$Y.coord)
emp_var_oz<- variogram(emp_res~1,locations=~ozone$X.coord+ozone$Y.coord,ozone)
ozone$emp_res<-emp_res
emp_var_oz<- variogram(emp_res~1,locations=~ozone$X.coord+ozone$Y.coord,ozone)
emp_var_oz<- variogram(emp_res~1,locations=~X.coord+Y.coord,ozone)
View(emp_var_oz)
plot(emp_var_oz,col="black",type="p",pch=20)
source('~/.active-rstudio-document', echo=TRUE)
plot(emp_var_oz,col="black",type="p",pch=20,main="Empirical Semi-variogram for the ozone data by CMAQ)
plot(emp_var_oz,col="black",type="p",pch=20,main="Empirical Semi-variogram for the ozone data by CMAQ")
plot(emp_var_oz,col="black",type="p",pch=20,main="Empirical Semi-variogram for the ozone data by CMAQ")
?vgm
exp_var_oz <- fit.variogram(emp_var_oz,vgm(psill=115,"Exp",150,60),fit.method=2)
90.92+42.14
?vgm
fit.method
?fit.method
76.89+48.55
?fit.variogram.reml
repl_var_oz <- fit.variogram.reml(emp_res~1,locations=~X.coord+Y.coord,data=ozone,model=(psill=115,"Exp",150,60)
repl_var_oz <- fit.variogram.reml(emp_res~1,locations=~X.coord+Y.coord,data=ozone,model=(psill=115,"Exp",150,60))
repl_var_oz <- fit.variogram.reml(emp_res~1,locations=~X.coord+Y.coord,data=ozone,model=vgm(psill=115,"Exp",150,60))
repl_var_oz
85.746+44.483
print(plot(emp_var_oz,exp_var_oz))
reml_var_oz <- fit.variogram.reml(emp_res~1,locations=~X.coord+Y.coord,data=ozone,model=vgm(psill=115,"Exp",150,60))
reml_var_oz
print(plot(emp_var_oz,reml_var_oz))
print(plot(emp_var_oz,reml_var_oz,main="REML empirical semi-variogram"))
print(plot(emp_var_oz,exp_var_oz,main="Exponential WLS semi-variogram"))
print(plot(emp_var_oz,reml_var_oz,main="REML empirical semi-variogram"))
reml_var_oz
?likfit
??likfit
library(geoR)
install.packages(geoR)
install.packages("geoR")
reml_var_oz
?reml_var_oz
type(reml_var_oz)
?krige.control
library(geoR)
?krig.control
?krige.control
View(ozone)
oz.df<-data.frame(ozone$X.coord,ozone$Y.coord,ozone$Ozone,ozone$CMAQ)
oz.geo<-as.geodata(oz.df,coords.col=c(1,2),data.col=c(3,4))
View(oz.df)
oz.df<-data.frame(cbind(ozone$X.coord,ozone$Y.coord,ozone$Ozone,ozone$CMAQ))
oz.geo<-as.geodata(oz.df,coords.col=c(1,2),data.col=c(3,4))
View(oz.df)
bp.df<-data.frame(cbind(bp$X.coord,bp$Y.coord,bp$CMAQ))
bp.geo<-as.geodata(bp.df,coords.col=c(1,2),data.col=c(3))
?krige.control
oz.geo
?oz.geo
sigma2.reml <- reml_var_oz$sigmasq
phi.reml <- reml_var_oz$phi
tau2.reml <- reml_var_oz$tausq
krig.oz.s0 <- krige.conv(bp.geo,coords=bp.geo$coords,data=bp.geo$data[,1],
locations=bp$coords,krige=kr.oz.control)
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,1],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
sigma2.reml <- reml_var_oz$sigmasq
phi.reml <- reml_var_oz$phi
tau2.reml <- reml_var_oz$tausq
sigma2.reml <- reml_var_oz$psill[2]
phi.reml <- reml_var_oz$range[2]
tau2.reml <- reml_var_oz$psill[1]
oz.df<-data.frame(cbind(ozone$X.coord,ozone$Y.coord,ozone$Ozone,ozone$CMAQ))
oz.geo<-as.geodata(oz.df,coords.col=c(1,2),data.col=c(3,4))
bp.df<-data.frame(cbind(bp$X.coord,bp$Y.coord,bp$CMAQ))
bp.geo<-as.geodata(bp.df,coords.col=c(1,2),data.col=c(3))
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,1],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(bp.geo,coords=bp.geo$coords,data=bp.geo$data[,1],
locations=bp$coords,krige=kr.oz.control)
krige.conv
?krige.conv
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp$coords,krige=kr.oz.control)
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,1],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
oz.geo$data
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,2],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp$coords,krige=kr.oz.control)
oz.geo$coords
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,2],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,2],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,1],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
library(geoR)
sigma2.reml <- reml_var_oz$psill[2]
phi.reml <- reml_var_oz$range[2]
tau2.reml <- reml_var_oz$psill[1]
oz.df<-data.frame(cbind(ozone$X.coord,ozone$Y.coord,ozone$Ozone,ozone$CMAQ))
oz.geo<-as.geodata(oz.df,coords.col=c(1,2),data.col=c(3,4))
bp.df<-data.frame(cbind(bp$X.coord,bp$Y.coord,bp$CMAQ))
bp.geo<-as.geodata(bp.df,coords.col=c(1,2),data.col=c(3))
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data[,1],cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
bp.geo$data
kr.oz.control <- krige.control(type.krige="ok",trend.d=~oz.geo$data[,2],trend.l=~bp.geo$data,cov.model="exponential",
cov.pars=c(sigma2.reml,phi.reml),nugget=tau2.reml)
krig.oz.s0 <- krige.conv(oz.geo,coords=oz.geo$coords,data=oz.geo$data[,1],
locations=bp.geo$coords,krige=kr.oz.control)
krig_pred<krig.oz.s0$predict
krig_pred<-krig.oz.s0$predict
krig_pred<-krig.oz.s0$predict
which.min(krig.oz.s0$krige.var)
summary(big_subset$Blood_pressure,big_subset$Ozone)
summary(big_subset$Blood_pressure)
summary(big_subset$Ozone)
summary(bp$Blood_pressure)
summary(bp$Blood_pressure)
summary(big_subset$Blood_pressure)
which.min(krig.oz.s0$krige.var)
bp[1536,1:2]
bp[1536,3:4]
lon <- ozone$longitude
lat <- ozone$latitude
o3 <-  ozone$Ozone
plotvar <- o3
nclr <- 9
plotclr <- brewer.pal(nclr,"Purples")
class <- classIntervals(plotvar,nclr,style="fixed",fixedBreaks=seq(min(plotvar),max(plotvar),length=nclr+1))
colcode <- findColours(class,plotclr)
length.x <- 25
length.y <- 25
x.grid <- seq(min(lon),max(lon),length=length.x)
y.grid <- seq(min(lat),max(lat),length=length.y)
z.grid <- matrix(NA,nrow=length.x,ncol=length.y)
z.lim <- range(plotvar)
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col=colcode,pch=20)
bp[1536,3:4]
bp[1536,1:2]
points(bp[1536,1],bp[1536,2)]
points(bp[1536,1],bp[1536,2])
points(bp[1536,1],bp[1536,2])
points(bp[1536,1],bp[1536,2]col="yellow")
points(bp[1536,1],bp[1536,2],col="yellow")
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col=colcode,pch=20)
points(bp[1536,1],bp[1536,2],col="yellow")
points(bp[1536,1],bp[1536,2],fill="yellow",col="yellow")
points(bp[1536,1],bp[1536,2],fill="yellow",col="yellow")
points(lon,lat,col=black,pch=20)
points(lon,lat,col=black,pch=20)
points(lon,lat,col="black"",pch=20)
points(bp[1536,1],bp[1536,2],,col="yellow")
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col="black",pch=20)
points(bp[1536,1],bp[1536,2],,col="yellow")
which.max(krig.oz.s0$krige.var)
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col="black",pch=20)
points(bp[1536,1],bp[1536,2],,col="yellow")
summary(krig_var)
which.max(krig.oz.s0$krige.var)
bp[1536,3:4]
bp[1536,1:2]
lon <- ozone$longitude
lat <- ozone$latitude
o3 <-  ozone$Ozone
plotvar <- o3
nclr <- 9
plotclr <- brewer.pal(nclr,"Purples")
class <- classIntervals(plotvar,nclr,style="fixed",fixedBreaks=seq(min(plotvar),max(plotvar),length=nclr+1))
colcode <- findColours(class,plotclr)
length.x <- 25
length.y <- 25
x.grid <- seq(min(lon),max(lon),length=length.x)
y.grid <- seq(min(lat),max(lat),length=length.y)
z.grid <- matrix(NA,nrow=length.x,ncol=length.y)
z.lim <- range(plotvar)
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col="black",pch=20)
points(bp[1536,1],bp[1536,2],,col="yellow")
summary(krig_var)
which.max(krig.oz.s0$krige.var)
bp[3358,3:4]
bp[3358,1:2]
lon <- ozone$longitude
lat <- ozone$latitude
o3 <-  ozone$Ozone
plotvar <- o3
nclr <- 9
plotclr <- brewer.pal(nclr,"Purples")
class <- classIntervals(plotvar,nclr,style="fixed",fixedBreaks=seq(min(plotvar),max(plotvar),length=nclr+1))
colcode <- findColours(class,plotclr)
length.x <- 25
length.y <- 25
x.grid <- seq(min(lon),max(lon),length=length.x)
y.grid <- seq(min(lat),max(lat),length=length.y)
z.grid <- matrix(NA,nrow=length.x,ncol=length.y)
z.lim <- range(plotvar)
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col="black",pch=20)
points(bp[3358,1],bp[3358,2],,col="yellow")
points(bp[3358,1],bp[3358,2],col="yellow")
points(bp[3358,1],bp[3358,2],col="red")
lon <- ozone$longitude
lat <- ozone$latitude
o3 <-  ozone$Ozone
plotvar <- o3
nclr <- 9
plotclr <- brewer.pal(nclr,"Purples")
class <- classIntervals(plotvar,nclr,style="fixed",fixedBreaks=seq(min(plotvar),max(plotvar),length=nclr+1))
colcode <- findColours(class,plotclr)
length.x <- 25
length.y <- 25
x.grid <- seq(min(lon),max(lon),length=length.x)
y.grid <- seq(min(lat),max(lat),length=length.y)
z.grid <- matrix(NA,nrow=length.x,ncol=length.y)
z.lim <- range(plotvar)
image.plot(x.grid,y.grid,z.grid,xlab="Latitude",ylab="Longitude",zlim=z.lim,
col=plotclr,breaks=class$brks,legend.lab="ppb",main="Ozone concentration on 08/31/2001")
US(xlim=range(lon),ylim=range(lat),add=T,lwd=1,col="gray")
points(lon,lat,col=colcode,pch=20)
points(bp[3358,1],bp[3358,2],col="red")
points(bp[3358,1],bp[3358,2],col="red".pch=20)
points(bp[3358,1],bp[3358,2],col="red",pch=20)
View(big_data)
kr_mod<-lm(big_data$Blood_pressure~krig_pred)
kr_model<-lm(big_data$Blood_pressure~krig_pred)
summary(kr_model)
The
data2<-read.table("Observed_ozone_concentration_subregion.txt",header=TRUE)
View(data2)
length(data2)
length(data2$Ozone)
data21<-data2[21:173,]
train<-data2[21:173,]
data2<-read.table("Observed_ozone_concentration_subregion.txt",header=TRUE)
train<-data2[21:173,]
train_mod<-lm(train$Ozone,train$CMAQ)
train_mod<-lm(train$Ozone ~ train$CMAQ)
test<-data2[1:20,]
summary(train_mod)
?predict
predict(train_mod)
summary(train_mod,test$CMAQ)
test_ozone<-predict(train_mod,test$CMAQ)
test_ozone<-predict(train_mod,test)
train_mod<-lm(train$Ozone ~ train$CMAQ)
summary(train_mod)
test_ozone<-predict(train_mod,test)
train_mod<-lm(Ozone ~ CMAQ,train)
test_ozone<-predict(train_mod,test)
diffs<-(test$Ozone-test_ozone)
MSPE<-mean((diffs)^2)
diffs^2
mean(diffs^2)
MAPE<-mean(abs(diffs))
MAPE
abs(diffs)
coords <- as.matrix(cbind(train$X.coord, train$Y.coord),nrow=length(train$X.coord),ncol=2)
ie-10
ie(-10)
phi.ini <- runif(1,min=1e-10,max=1)
library(spBayes)
install.packages(spBayes0)
install.packages(spBayes\)
install.packages(spBayes)
install.packages("spBayes")
library(spBayes)
x=rgamma(1000,10,810)
mean(x)
x<-rgamma(10000,10,810)
mean(x)
x<-rgamma(10000,10,450)
mean(x)
sigma2.mean<-1/0.0222
sigma2.mean
tau2.mean
tau2.mean<-1/0.01225954
tau2.mean
p<-runif(100000,min=1e-10,max=1)
mean(p)
sigma2.mean
taus2.mean
tau2.mean
coords <- as.matrix(cbind(train$X.coord, train$Y.coord),nrow=length(train$X.coord),ncol=2)
beta.ini <- rep(0,5)
sigma2.ini <- 1/rgamma(1,10,450)
sigma2.mean<-1/0.0222
tau2.ini <- 1/rgamma(1,10,810)
tau2.mean<-1/0.01225954
phi.ini <- runif(1,min=1e-10,max=1)
phi.mean<-0.5
#############  Fitting the model
# This fits the model
model.1 <- spLM(train$Ozone~ train$CMAQ,
coords=coords,starting=list("phi"=phi.ini,"sigma.sq"=sigma2.ini, "tau.sq"=tau2.ini,"beta"=beta.ini),
tuning=list("phi"=0.5, "sigma.sq"=45, "tau.sq"=81),
priors=list("phi.Unif"=c(1e-10, 1), "sigma.sq.IG"=c(10, 4510),
"tau.sq.IG"=c(10, 810),"beta.Flat"), cov.model="exponential",
n.samples=50000, verbose=TRUE, n.report=100)
names(model.1)
model.1$p.theta.samples[1:5,]
model.1$p.theta.samples
par(mai=rep(0.4,4))
plot(model.1$p.theta.samples[,1:3])
model.1$p.theta.samples[1:5,]
dim(model.1.other.pars$p.beta.recover.samples)
n.samples <- 5000
burn.in <- 0.5*n.samples
model.1.other.pars <- spRecover(model.1, start=burn.in, verbose=FALSE)
dim(model.1.other.pars$p.beta.recover.samples)
par(mai=rep(0.4,4),mfrow=c(2,2))
plot(model.1.other.pars$p.beta.recover.samples[,1:4])
par(mai=rep(0.4,4))
plot(model.1.other.pars$p.beta.recover.samples[,5])
par(mai=rep(0.4,4),mfrow=c(2,2))
plot(model.1.other.pars$p.theta.samples[,1:3])
round(summary(model.1.other.pars$p.theta.samples)$quantiles[,c(1,3,5)],2)
round(summary(model.1.other.pars$p.theta.samples)$quantiles[,c(1,3,5)],5)
round(summary(model.1.other.pars$p.beta.recover.samples)$quantiles[,c(1,3,5)],5)
x<-runif(10000,1e-10,1)
mean(x)
?spLM
x<-1/rgamma(1000,2,1)
mean(x)
model.1 <- spLM(train$Ozone~ train$CMAQ,
coords=coords,starting=list("phi"=phi.ini,"sigma.sq"=sigma2.ini, "tau.sq"=tau2.ini,"beta"=beta.ini),
tuning=list("phi"=0.1, "sigma.sq"=0.1, "tau.sq"=0.1),
priors=list("phi.Unif"=c(1e-10, 1), "sigma.sq.IG"=c(10, 4510),
"tau.sq.IG"=c(10, 810),"beta.Flat"), cov.model="exponential",
n.samples=5000, verbose=TRUE, n.report=100)
model.1 <- spLM(train$Ozone~ train$CMAQ,
coords=coords,starting=list("phi"=phi.ini,"sigma.sq"=sigma2.ini, "tau.sq"=tau2.ini,"beta"=beta.ini),
tuning=list("phi"=0.1, "sigma.sq"=0.1, "tau.sq"=0.1),
priors=list("phi.Unif"=c(1e-10, 1), "sigma.sq.IG"=c(10, 4510),
"tau.sq.IG"=c(10, 810),"beta.Flat"), cov.model="exponential",
n.samples=50000, verbose=TRUE, n.report=100)
par(mai=rep(0.4,4))
plot(model.1$p.theta.samples[,1:3])
model.1 <- spLM(train$Ozone~ train$CMAQ,
coords=coords,starting=list("phi"=phi.ini,"sigma.sq"=sigma2.ini, "tau.sq"=tau2.ini,"beta"=beta.ini),
tuning=list("phi"=0.1, "sigma.sq"=0.1, "tau.sq"=0.1),
priors=list("phi.Unif"=c(1e-10, 1), "sigma.sq.IG"=c(10, 450),
"tau.sq.IG"=c(10, 810),"beta.Flat"), cov.model="exponential",
n.samples=50000, verbose=TRUE, n.report=100)
par(mai=rep(0.4,4))
plot(model.1$p.theta.samples[,1:3])
n.samples <- 5000
burn.in <- 0.5*n.samples
model.1.other.pars <- spRecover(model.1, start=burn.in, verbose=TRUE)
round(summary(model.1.other.pars$p.theta.samples)$quantiles[,c(1,3,5)],5)
round(summary(model.1.other.pars$p.beta.recover.samples)$quantiles[,c(1,3,5)],5)
train.predcov <- matrix(cbind(rep(1, n.pred), train$CMAQ,nrow=n.pred,ncol=2)
train.predcov <- matrix(cbind(rep(1, n.pred), train$CMAQ),nrow=n.pred,ncol=2)
n.pred <- 20
train.predcov <- matrix(cbind(rep(1, n.pred), train$CMAQ),nrow=n.pred,ncol=2)
length(train)
test.predcov <- matrix(cbind(rep(1, n.pred),test$CMAQ),nrow=n.pred,ncol=2)
pred.coords <- cbind(test$X.coord, test$Y.coord)
pred <- spPredict(model.1, pred.coords=pred.coords, pred.covars=test.predcov, start=burn.in, thin=2)
post.pred.mean <- rowMeans(pred$p.y.predictive.samples)
post.pred.mean[1:10]
## Here we compute the 95% posterior predictive intervals at the 237 sites
post.pred.95ci <- apply(pred$p.y.predictive.samples,1,quantile,c(0.025,0.975))
post.pred.95ci[,1:10]
Y.pred <- test$Ozone
mean(abs((post.pred.mean-Y.pred))[Y.pred!=-Inf])
sqrt(mean(((post.pred.mean-Y.pred)^2)[Y.pred!=-Inf]))
MSPE
MAPE
mean(((post.pred.mean-Y.pred)^2)[Y.pred!=-Inf])
data2<-read.table("Observed_ozone_concentration_subregion.txt",header=TRUE)
?read.table
